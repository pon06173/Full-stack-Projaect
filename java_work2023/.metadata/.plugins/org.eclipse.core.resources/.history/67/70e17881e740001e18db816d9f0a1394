package org.comstudy.myapp;

import java.io.IOException;
import java.io.PrintWriter;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Scanner;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

interface Command {
   void procerss();
}

class Input implements Command {
   @Override
   public void procerss() {
      System.out.println("Input");
   }
}

class Output implements Command {
   @Override
   public void procerss() {
      System.out.println("Output");
   }
}

class Modify implements Command {
   @Override
   public void procerss() {
      System.out.println("Modify");
   }
}

class Search implements Command {
   @Override
   public void procerss() {
      System.out.println("Search");
   }
}

class Delete implements Command {
   @Override
   public void procerss() {
      System.out.println("Delete");
   }
}

// URI와 클래스를 매핑을 해야 브라우저에서 실행 가능하다.
@WebServlet("*.do")
public class PhoneBookApp extends HttpServlet {
   public static Scanner scan = new Scanner(System.in);
   public static final ArrayList<Phone> phoneList = new ArrayList<Phone>();
   public static int noSequence = 1;
   static {
      phoneList.add(new Phone(noSequence++, "홍길동", "010-1111-1111"));
      phoneList.add(new Phone(noSequence++, "김길동", "010-2222-2222"));
      phoneList.add(new Phone(noSequence++, "박길동", "010-3333-3333"));
   }
   public static final HashMap<String, Command> commandMap = new HashMap<String, Command>();
   static {
      // static 초기화 블럭 - static 멤버를 초기화 한다.
      commandMap.put("/input.do", new Input());
      commandMap.put("/output.do", new Output());
      commandMap.put("/search.do", new Search());
      commandMap.put("/modify.do", new Modify());
      commandMap.put("/delete.do", new Delete());
   }
   public static Command command = null;

   @Override
   protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
      //System.out.println(">>>>> doGet() - HelloServlet 호출 ...");
      //System.out.println("RequestURI: " + req.getRequestURI());
      //System.out.println("ContextPath: " + req.getContextPath());
      int beginIndex = req.getContextPath().length();
      String endPoint = req.getRequestURI().substring(beginIndex);
      //System.out.println("EndPoint: " + endPoint);
      
      command = commandMap.get(endPoint);
      command.procerss();
      
      PrintWriter out = resp.getWriter();
      out.write("<h1>Hello Servlet</h1>");
      out.close();
   }
}